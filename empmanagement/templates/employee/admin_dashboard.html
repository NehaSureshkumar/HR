{% extends 'employee/base.html' %}

{% block title %}HR Dashboard - Employee Management System{% endblock %}

{% block content %}
<header class="flex items-center justify-between bg-white shadow px-6 py-4 sticky top-0 z-10">
    <div class="flex items-center space-x-4">
        <img src="/static/images/logo.png" alt="Logo" class="h-8 w-8 rounded-full shadow" />
        <span class="text-2xl font-bold text-blue-700 font-sans tracking-tight">Dashboard Overview</span>
    </div>
    <div class="flex items-center space-x-4">
        <button class="relative group" title="Notifications">
            <span class="material-icons text-gray-500 text-2xl">notifications</span>
            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full ring-2 ring-white bg-red-500"></span>
            <span class="sr-only">Notifications</span>
        </button>
        <div class="relative group">
            <img src="https://ui-avatars.com/api/?name={{ user_profile.user.get_full_name|urlencode }}" alt="Profile" class="w-10 h-10 rounded-full border shadow cursor-pointer" />
            <div class="absolute right-0 mt-2 w-40 bg-white rounded shadow-lg py-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-20">
                <div class="px-4 py-2 text-gray-700 font-medium">{{ user_profile.user.get_full_name }}</div>
                <div class="border-t"></div>
                <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-600 hover:bg-gray-100">My Profile</a>
                <a href="/accounts/logout/" class="block px-4 py-2 text-gray-600 hover:bg-gray-100">Logout</a>
            </div>
        </div>
                </div>
</header>
<main class="flex-1 p-6 bg-gradient-to-br from-gray-50 via-white to-blue-50 min-h-screen font-sans">
    <!-- Dashboard Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="dashboard-card bg-gradient-to-br from-green-100 to-green-50 rounded-xl shadow-lg p-5 flex flex-col items-start border-l-4 border-green-400">
            <div class="text-xs text-gray-500 mb-1">Ongoing Active Hirings</div>
            <div class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-green-700">+{{ active_hirings }}</span>
                <span class="bg-green-200 text-green-800 text-xs px-2 py-1 rounded">On Track</span>
            </div>
                </div>
        <div class="dashboard-card bg-gradient-to-br from-blue-100 to-blue-50 rounded-xl shadow-lg p-5 flex flex-col items-start border-l-4 border-blue-400">
            <div class="text-xs text-gray-500 mb-1">Employee Count</div>
            <div class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-blue-700">{{ total_employees }}</span>
                <span class="bg-blue-200 text-blue-800 text-xs px-2 py-1 rounded">Stable</span>
            </div>
                </div>
        <div class="dashboard-card bg-gradient-to-br from-yellow-100 to-yellow-50 rounded-xl shadow-lg p-5 flex flex-col items-start border-l-4 border-yellow-400">
            <div class="text-xs text-gray-500 mb-1">Ongoing Projects</div>
            <div class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-yellow-700">{{ ongoing_projects.count }}</span>
                <span class="bg-yellow-200 text-yellow-800 text-xs px-2 py-1 rounded">At Risk</span>
            </div>
        </div>
        <div class="dashboard-card bg-gradient-to-br from-orange-100 to-orange-50 rounded-xl shadow-lg p-5 flex flex-col items-start border-l-4 border-orange-400">
            <div class="text-xs text-gray-500 mb-1">Upcoming Projects</div>
            <div class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-orange-700">{{ upcoming_projects.count }}</span>
                <span class="bg-orange-200 text-orange-800 text-xs px-2 py-1 rounded">On Schedule</span>
                </div>
            </div>
        </div>

    <!-- Tabbed Content -->
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center border-b mb-4 space-x-2">
            <button class="tab-btn px-4 py-2 rounded-full font-semibold text-blue-700 border-b-2 border-blue-700 bg-blue-50 focus:outline-none transition" onclick="showTab('pf')">PF Views</button>
            <button class="tab-btn px-4 py-2 rounded-full text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition" onclick="showTab('bank')">Bank Account Details</button>
            <button class="tab-btn px-4 py-2 rounded-full text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition" onclick="showTab('insurance')">Insurance Policy</button>
            <button class="tab-btn px-4 py-2 rounded-full text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition" onclick="showTab('tax')">Income Tax Details</button>
            <button class="tab-btn px-4 py-2 rounded-full text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition" onclick="showTab('personal')">Personal Details</button>
                </div>
        <!-- Search/Filter/Export -->
        <div class="flex flex-wrap items-center justify-between mb-4">
            <div class="flex items-center space-x-2">
                <input type="text" id="employeeSearch" placeholder="Search employees..." class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-200" onkeyup="filterTable()">
                <button class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">Filter</button>
            </div>
            <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">Export</button>
        </div>
        <!-- Table containers will use overflow-x-auto for mobile -->
        <div class="overflow-x-auto">
            <!-- All tables here (PF, Bank, Insurance, Tax, Personal) will have sticky headers, zebra striping, and hover effects -->
            <!-- Employee Table (PF Tab) -->
            <div id="tab-pf" class="tab-content">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designation</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Join Date</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTable" class="bg-white divide-y divide-gray-200">
                        {% for employee in employees %}
                        <tr>
                            <td class="px-4 py-2 flex items-center space-x-2">
                                <img src="https://ui-avatars.com/api/?name={{ employee.firstName }}+{{ employee.lastName }}" class="w-8 h-8 rounded-full" alt="Avatar">
                                <div>
                                    <div class="font-medium text-gray-800">{{ employee.firstName }} {{ employee.lastName }}</div>
                                </div>
                            </td>
                            <td class="px-4 py-2">{{ employee.email }}</td>
                            <td class="px-4 py-2">{{ employee.designation|default:'-' }}</td>
                            <td class="px-4 py-2">{{ employee.department|default:'-' }}</td>
                            <td class="px-4 py-2">
                                <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span>
                            </td>
                            <td class="px-4 py-2">{{ employee.joinDate|date:'M d, Y' }}</td>
                            <td class="px-4 py-2 flex space-x-2">
                                {% if employee.id %}
                                    <a href="{% url 'employee_detail' employee.id %}" class="text-blue-600 hover:text-blue-900" title="View"><span class="material-icons">visibility</span></a>
                                    <a href="{% url 'edit_employee' employee.id %}" class="text-yellow-600 hover:text-yellow-900" title="Edit"><span class="material-icons">edit</span></a>
                                    <a href="{% url 'delete_employee' employee.id %}" class="text-red-600 hover:text-red-900" title="Delete"><span class="material-icons">delete</span></a>
                                {% else %}
                                    <span class="text-gray-400" title="Not available">-</span>
                                {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center py-4 text-gray-500">No employees found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
            <!-- Bank Account Details Tab -->
            <div id="tab-bank" class="tab-content hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designation</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Account Number</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">IFSC</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in bank_details %}
                    <tr>
                        <td class="px-4 py-2 flex items-center space-x-2">
                            <img src="https://ui-avatars.com/api/?name={{ item.employee.firstName }}+{{ item.employee.lastName }}" class="w-8 h-8 rounded-full" alt="Avatar">
                            <div>{{ item.employee.firstName }} {{ item.employee.lastName }}</div>
                        </td>
                        <td class="px-4 py-2">{{ item.employee.email }}</td>
                        <td class="px-4 py-2">{{ item.employee.designation|default:'-' }}</td>
                        <td class="px-4 py-2 {% if not item.account_number %}text-red-500{% endif %}">{{ item.account_number|default:'-' }}</td>
                        <td class="px-4 py-2 {% if not item.ifsc %}text-red-500{% endif %}">{{ item.ifsc|default:'-' }}</td>
                        <td class="px-4 py-2">
                            {% if item.account_number and item.ifsc %}
                                <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Complete</span>
                            {% else %}
                                <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs">Missing Info</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-2">
                            <button class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="openEditModal('bank', '{{ item.employee.eID }}')">Edit</button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center py-4 text-gray-500">No data found.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Insurance Policy Tab -->
            <div id="tab-insurance" class="tab-content hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designation</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Policy</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in insurance_policies %}
                    <tr>
                        <td class="px-4 py-2 flex items-center space-x-2">
                            <img src="https://ui-avatars.com/api/?name={{ item.employee.firstName }}+{{ item.employee.lastName }}" class="w-8 h-8 rounded-full" alt="Avatar">
                            <div>{{ item.employee.firstName }} {{ item.employee.lastName }}</div>
                        </td>
                        <td class="px-4 py-2">{{ item.employee.email }}</td>
                        <td class="px-4 py-2">{{ item.employee.designation|default:'-' }}</td>
                        <td class="px-4 py-2">{{ item.policy }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center py-4 text-gray-500">No data found.</td></tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Income Tax Details Tab -->
            <div id="tab-tax" class="tab-content hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designation</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tax</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in tax_details %}
                    <tr>
                        <td class="px-4 py-2 flex items-center space-x-2">
                            <img src="https://ui-avatars.com/api/?name={{ item.employee.firstName }}+{{ item.employee.lastName }}" class="w-8 h-8 rounded-full" alt="Avatar">
                            <div>{{ item.employee.firstName }} {{ item.employee.lastName }}</div>
                        </td>
                        <td class="px-4 py-2">{{ item.employee.email }}</td>
                        <td class="px-4 py-2">{{ item.employee.designation|default:'-' }}</td>
                        <td class="px-4 py-2">{{ item.tax }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-center py-4 text-gray-500">No data found.</td></tr>
                {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Personal Details Tab -->
            <div id="tab-personal" class="tab-content hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designation</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Emergency Contact Name</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Emergency Contact Phone</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in personal_details %}
                    <tr>
                        <td class="px-4 py-2 flex items-center space-x-2">
                            <img src="https://ui-avatars.com/api/?name={{ item.employee.firstName }}+{{ item.employee.lastName }}" class="w-8 h-8 rounded-full" alt="Avatar">
                            <div>{{ item.employee.firstName }} {{ item.employee.lastName }}</div>
                        </td>
                        <td class="px-4 py-2">{{ item.employee.email }}</td>
                        <td class="px-4 py-2">{{ item.employee.designation|default:'-' }}</td>
                        <td class="px-4 py-2 {% if not item.emergency_contact_name %}text-red-500{% endif %}">{{ item.emergency_contact_name|default:'-' }}</td>
                        <td class="px-4 py-2 {% if not item.emergency_contact_phone %}text-red-500{% endif %}">{{ item.emergency_contact_phone|default:'-' }}</td>
                        <td class="px-4 py-2">
                            {% if item.emergency_contact_name and item.emergency_contact_phone %}
                                <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Complete</span>
                            {% else %}
                                <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs">Missing Info</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-2">
                            <button class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="openEditModal('personal', '{{ item.employee.eID }}')">Edit</button>
                        </td>
                    </tr>
            {% empty %}
                    <tr><td colspan="7" class="text-center py-4 text-gray-500">No data found.</td></tr>
                {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<!-- JS for sidebar and tabs -->
<script>
function toggleMenu(id) {
    var el = document.getElementById(id);
    if (el.classList.contains('hidden')) {
        el.classList.remove('hidden');
    } else {
        el.classList.add('hidden');
    }
}
function showTab(tab) {
    document.querySelectorAll('.tab-content').forEach(function(el) {
        el.classList.add('hidden');
        el.style.opacity = '0';
    });
    document.getElementById('tab-' + tab).classList.remove('hidden');
    document.getElementById('tab-' + tab).style.opacity = '1';
    document.querySelectorAll('.tab-btn').forEach(function(btn) {
        btn.classList.remove('font-semibold', 'text-blue-700', 'border-b-2', 'border-blue-700');
    });
    event.target.classList.add('font-semibold', 'text-blue-700', 'border-b-2', 'border-blue-700');
}
function filterTable() {
    var input = document.getElementById('employeeSearch').value.toLowerCase();
    var rows = document.getElementById('employeeTable').getElementsByTagName('tr');
    for (var i = 0; i < rows.length; i++) {
        var name = rows[i].getElementsByTagName('td')[1]?.textContent.toLowerCase() || '';
        if (name.indexOf(input) > -1) {
            rows[i].style.display = '';
        } else {
            rows[i].style.display = 'none';
        }
    }
}
// Set default tab
showTab('pf');
</script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
    .dashboard-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .tab-btn {
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    .tab-btn:hover {
        background-color: #e2e8f0;
    }
    .tab-content {
        transition: opacity 0.3s ease;
    }
    .tab-content.hidden {
        opacity: 0;
    }
    .tab-content:not(.hidden) {
        opacity: 1;
    }
</style>
{% endblock %} 